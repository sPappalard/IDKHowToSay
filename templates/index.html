<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Learning Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 1s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #fff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
        }

        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: slideUp 0.8s ease-out;
            transition: all 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .language-selector {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-btn.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .load-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; }
        .btn-secondary { background: linear-gradient(45deg, #2196F3, #1976D2); color: white; }
        .btn-danger { background: linear-gradient(45deg, #f44336, #d32f2f); color: white; }
        .btn-warning { background: linear-gradient(45deg, #ff9800, #f57c00); color: white; }
        .btn-info { background: linear-gradient(45deg, #9c27b0, #7b1fa2); color: white; }
        .btn-dark { background: linear-gradient(45deg, #555, #333); color: white; }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .form-control, .select-control {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .select-control {
            cursor: pointer;
        }

        .select-control option {
            background: #333;
            color: white;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-control:focus, .select-control:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            color: #000000;
            font-weight: bold;
            text-shadow: 0 0 2px white;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .status.loading {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .language-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .language-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .language-label {
            color: white;
            font-weight: 500;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .setting-label {
            color: white;
            font-weight: 500;
        }

        .setting-input {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 80px;
            text-align: center;
        }

        .game-modes {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .mode-btn {
            padding: 25px 40px;
            font-size: 1.2rem;
            border-radius: 20px;
            min-width: 220px;
        }

        .game-screen {
            display: none;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-info {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .score-item {
            text-align: center;
            color: white;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }

        .score-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .question-card {
            text-align: center;
            padding: 40px;
            margin: 30px 0;
        }

        .question-text {
            font-size: 1.8rem;
            color: white;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .question-word {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .solution-container {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .solution-text {
            font-size: 1.2rem;
            color: white;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .solution-word {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .audio-btn {
            background: linear-gradient(45deg, #9c27b0, #7b1fa2);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);
        }

        .audio-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
        }

        .answer-section {
            margin: 30px 0;
        }

        .answer-label {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: block;
        }

        .answer-input {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.3rem;
            text-align: center;
            margin: 0 auto;
            display: block;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
            background: rgba(255, 255, 255, 0.3);
        }

        .result-message {
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-correct {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
            color: white;
            border: 2px solid #2E7D32;
            text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .result-incorrect {
            background: linear-gradient(135deg, #f44336, #D32F2F);
            color: white;
            border: 2px solid #C62828;
            text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .result-skipped {
            background: linear-gradient(135deg, #ff9800, #F57C00);
            color: white;
            border: 2px solid #EF6C00;
            text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .game-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: #333;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .load-section {
                flex-direction: column;
            }
            
            .language-settings {
                grid-template-columns: 1fr;
            }
            
            .game-modes {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-btn {
                min-width: auto;
                width: 100%;
                max-width: 300px;
            }
            
            .game-header {
                flex-direction: column;
                text-align: center;
            }
            
            .question-word {
                font-size: 2rem;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="setUILanguage('en')" data-lang="en">EN</button>
        <button class="lang-btn" onclick="setUILanguage('it')" data-lang="it">IT</button>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="info-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeInfoModal()">√ó</button>
            <h3 data-text="fileFormatTitle">File Format Information</h3>
            <div data-text="fileFormatContent">
                <p><strong>Required Format:</strong></p>
                <ul>
                    <li>Excel file (.xlsx, .xls) or CSV file (.csv)</li>
                    <li>First column: First Language words/phrases</li>
                    <li>Second column: Second Language words/phrases</li>
                    <li>Multiple variants can be separated by: / , \ ( )</li>
                </ul>
                <br>
                <p><strong>Example:</strong></p>
                <table border="1" style="width:100%; border-collapse: collapse;">
                    <tr><th>First Language</th><th>Second Language</th></tr>
                    <tr><td>house/home</td><td>casa</td></tr>
                    <tr><td>car, automobile</td><td>macchina, auto</td></tr>
                    <tr><td>book</td><td>libro</td></tr>
                </table>
                <br>
                <p><strong>Google Sheets:</strong><br>Make sure your sheet is public or shareable via link, then paste the URL.</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Menu Screen -->
        <div id="menu-screen">
            <div class="header">
                <h1 class="title" data-text="mainTitle">üéì Language Learning Game</h1>
                <p class="subtitle" data-text="subtitle">Learn languages in a fun and interactive way</p>
            </div>

            <!-- Language Selection Card -->
            <div class="card">
                <h3 style="color: white; margin-bottom: 20px; text-align: center;" data-text="languageSetup">üåê Language Setup</h3>
                <div class="language-settings">
                    <div class="language-item">
                        <label class="language-label" data-text="firstLanguage">First Language (Column 1):</label>
                        <select id="first-language" class="select-control" onchange="updateLanguages()">
                            <option value="italian">Italian</option>
                            <option value="english">English</option>
                            <option value="french">French</option>
                            <option value="spanish">Spanish</option>
                            <option value="german">German</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="language-item">
                        <label class="language-label" data-text="secondLanguage">Second Language (Column 2):</label>
                        <select id="second-language" class="select-control" onchange="updateLanguages()">
                            <option value="english">English</option>
                            <option value="italian">Italian</option>
                            <option value="french">French</option>
                            <option value="spanish">Spanish</option>
                            <option value="german">German</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <small style="color: rgba(255,255,255,0.7); text-align: center; display: block; margin-top: 10px;" data-text="languageHint">
                    üí° Select the languages that match your file columns: First Language = Column 1, Second Language = Column 2
                </small>
                <div id="audio-status" class="status" style="font-size: 0.9rem; padding: 10px;">
                    <span data-text="audioEnabled">Audio enabled for both languages</span>
                </div>
            </div>

            <!-- File Loading Card -->
            <div class="card">
                <div class="load-section">
                    <button class="btn btn-primary" onclick="loadExcelFile()">
                        <span data-text="loadExcel">üìÅ Load Excel File</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadGoogleSheets()">
                        <span data-text="loadSheets">üåê Load Google Sheets</span>
                    </button>
                    <button class="btn btn-info" onclick="showInfoModal()">
                        <span data-text="fileInfo">‚ÑπÔ∏è File Format Info</span>
                    </button>
                    <button class="btn btn-dark" onclick="downloadExample()">
                        <span data-text="downloadExample">üì• Download Example</span>
                    </button>
                </div>

                <div class="url-input-section">
                    <div class="input-group" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" id="sheets-url" class="form-control" 
                               data-placeholder="sheetsPlaceholder"
                               placeholder="üîó Paste your Google Sheets link here..." 
                               onkeypress="handleUrlKeyPress(event)">
                    </div>
                    <small style="color: rgba(255,255,255,0.7);" data-text="sheetsHint">
                        üí° For Google Sheets: share your sheet publicly and paste the link here
                    </small>
                </div>

                <div id="status" class="status" data-text="noDataLoaded">
                    No data loaded
                </div>

                <input type="file" id="file-input" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileUpload(event)">
            </div>

            <!-- Settings Card -->
            <div class="card">
                <h3 style="color: white; margin-bottom: 20px; text-align: center;" data-text="settings">‚öôÔ∏è Settings</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label" data-text="maxQuestions">Maximum questions:</span>
                        <input type="number" id="max-questions" class="setting-input" value="50" min="10" max="500">
                    </div>
                    <div class="setting-item">
                        <span class="setting-label" data-text="maxPasses">Maximum passes:</span>
                        <input type="number" id="max-passes" class="setting-input" value="3" min="0" max="20">
                    </div>
                </div>
            </div>

            <!-- Game Modes Card -->
            <div class="card">
                <div class="game-modes">
                    <button class="btn btn-danger mode-btn" id="first-second-btn" onclick="startGame('first_second')" disabled>
                        <span data-text="firstToSecond">üî§ First ‚Üí Second Language</span>
                    </button>
                    <button class="btn btn-primary mode-btn" id="second-first-btn" onclick="startGame('second_first')" disabled>
                        <span data-text="secondToFirst">üî§ Second ‚Üí First Language</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="game-screen">
            <div class="header">
                <h1 class="title" style="font-size: 2rem;" data-text="gameTitle">üéØ Language Learning Game</h1>
            </div>

            <div class="card">
                <div class="game-header">
                    <div class="score-info">
                        <div class="score-item">
                            <span id="score-value" class="score-value">0</span>
                            <span class="score-label" data-text="score">Score</span>
                        </div>
                        <div class="score-item">
                            <span id="question-progress" class="score-value">0/50</span>
                            <span class="score-label" data-text="questions">Questions</span>
                        </div>
                        <div class="score-item">
                            <span id="passes-left" class="score-value">3</span>
                            <span class="score-label" data-text="passesLeft">Passes left</span>
                        </div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
            </div>

            <div class="card question-card">
                <div id="question-text" class="question-text" data-text="translateTo">Translate to second language:</div>
                <div id="question-word" class="question-word">Loading...</div>
                
                <button id="audio-btn" class="audio-btn" onclick="playAudio()" title="Listen to pronunciation">
                    üîä
                </button>

                <div id="solution-container" class="solution-container">
                    <div class="solution-text" data-text="solution">Solution:</div>
                    <div id="solution-word" class="solution-word"></div>
                </div>

                <div class="answer-section">
                    <label class="answer-label" data-text="yourAnswer">Your answer:</label>
                    <input type="text" id="answer-input" class="answer-input" 
                           data-placeholder="answerPlaceholder"
                           placeholder="Type your translation here..." 
                           onkeypress="handleAnswerKeyPress(event)">
                </div>

                <div id="result-message" class="result-message"></div>

                <div class="game-controls">
                    <button id="check-btn" class="btn btn-primary" onclick="checkAnswer()">
                        <span data-text="confirm">‚úì Confirm</span>
                    </button>
                    <button id="solution-btn" class="btn btn-info" onclick="toggleSolution()">
                        <span data-text="showSolution">üëÅÔ∏è Show Solution</span>
                    </button>
                    <button id="pass-btn" class="btn btn-warning" onclick="passQuestion()">
                        <span data-text="pass">‚è≠Ô∏è Pass</span>
                    </button>
                    <button id="next-btn" class="btn btn-secondary" onclick="nextQuestion()" style="display: none;">
                        <span data-text="next">‚û°Ô∏è Next</span>
                    </button>
                    <button class="btn btn-danger" onclick="endGame()">
                        <span data-text="endGame">üèÅ End Game</span>
                    </button>
                    <button class="btn btn-dark" onclick="returnToMenu()">
                        <span data-text="menu">üè† Menu</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const API_BASE_URL = 'http://localhost:5000/api';
        let currentUILanguage = 'en';
        let gameState = {
            solutionVisible: false,
            audioEnabled: true,
            waitingForNext: false
        };

        // Translations
        const translations = {
            en: {
                mainTitle: "üéì Language Learning Game",
                subtitle: "Learn languages in a fun and interactive way",
                languageSetup: "üåê Language Setup",
                firstLanguage: "First Language (Column 1):",
                secondLanguage: "Second Language (Column 2):",
                languageHint: "üí° Select the languages that match your file columns: First Language = Column 1, Second Language = Column 2",
                audioEnabled: "Audio enabled for both languages",
                audioDisabled: "Audio disabled (Other language selected)",
                loadExcel: "üìÅ Load Excel File",
                loadSheets: "üåê Load Google Sheets", 
                fileInfo: "‚ÑπÔ∏è File Format Info",
                downloadExample: "üì• Download Example",
                sheetsPlaceholder: "üîó Paste your Google Sheets link here...",
                sheetsHint: "üí° For Google Sheets: share your sheet publicly and paste the link here",
                noDataLoaded: "No data loaded",
                settings: "‚öôÔ∏è Settings",
                maxQuestions: "Maximum questions:",
                maxPasses: "Maximum passes:",
                firstToSecond: "üî§ First ‚Üí Second Language",
                secondToFirst: "üî§ Second ‚Üí First Language",
                gameTitle: "üéØ Language Learning Game",
                score: "Score",
                questions: "Questions", 
                passesLeft: "Passes left",
                translateTo: "Translate to second language:",
                translateToFirst: "Translate to first language:",
                solution: "Solution:",
                yourAnswer: "Your answer:",
                answerPlaceholder: "Type your translation here...",
                confirm: "‚úì Confirm",
                showSolution: "üëÅÔ∏è Show Solution",
                hideSolution: "üôà Hide Solution", 
                pass: "‚è≠Ô∏è Pass",
                next: "‚û°Ô∏è Next",
                endGame: "üèÅ End Game",
                menu: "üè† Menu",
                fileFormatTitle: "File Format Information",
                fileFormatContent: `<p><strong>Required Format:</strong></p>
                    <ul>
                        <li>Excel file (.xlsx, .xls) or CSV file (.csv)</li>
                        <li><strong>Column 1:</strong> First Language words/phrases</li>
                        <li><strong>Column 2:</strong> Second Language words/phrases</li>
                        <li>Multiple variants can be separated by: / , \\ ( )</li>
                    </ul>
                    <br>
                    <p><strong>Example:</strong></p>
                    <table border="1" style="width:100%; border-collapse: collapse;">
                        <tr><th>Column 1 (First Language)</th><th>Column 2 (Second Language)</th></tr>
                        <tr><td>house/home</td><td>casa</td></tr>
                        <tr><td>car, automobile</td><td>macchina, auto</td></tr>
                        <tr><td>book</td><td>libro</td></tr>
                    </table>
                    <br>
                    <p><strong>Important:</strong> Make sure to select the correct languages in the dropdown that match your file columns!</p>
                    <br>
                    <p><strong>Google Sheets:</strong><br>Make sure your sheet is public or shareable via link, then paste the URL.</p>`
            },
            it: {
                mainTitle: "üéì Gioco di Apprendimento Linguistico",
                subtitle: "Impara le lingue in modo divertente e interattivo",
                languageSetup: "üåê Configurazione Lingue",
                firstLanguage: "Prima Lingua (Colonna 1):",
                secondLanguage: "Seconda Lingua (Colonna 2):",
                languageHint: "üí° Seleziona le lingue che corrispondono alle colonne del tuo file: Prima Lingua = Colonna 1, Seconda Lingua = Colonna 2",
                audioEnabled: "Audio abilitato per entrambe le lingue",
                audioDisabled: "Audio disabilitato (Altra lingua selezionata)",
                loadExcel: "üìÅ Carica File Excel",
                loadSheets: "üåê Carica Google Sheets",
                fileInfo: "‚ÑπÔ∏è Info Formato File",
                downloadExample: "üì• Scarica Esempio",
                sheetsPlaceholder: "üîó Incolla qui il link del Google Sheets...",
                sheetsHint: "üí° Per Google Sheets: condividi il foglio pubblicamente e incolla qui il link",
                noDataLoaded: "Nessun dato caricato",
                settings: "‚öôÔ∏è Impostazioni",
                maxQuestions: "Domande massime:",
                maxPasses: "Passi massimi:",
                firstToSecond: "üî§ Prima ‚Üí Seconda Lingua",
                secondToFirst: "üî§ Seconda ‚Üí Prima Lingua",
                gameTitle: "üéØ Gioco di Apprendimento Linguistico",
                score: "Punteggio",
                questions: "Domande",
                passesLeft: "Passi rimasti",
                translateTo: "Traduci nella seconda lingua:",
                translateToFirst: "Traduci nella prima lingua:",
                solution: "Soluzione:",
                yourAnswer: "La tua risposta:",
                answerPlaceholder: "Scrivi qui la traduzione...",
                confirm: "‚úì Conferma",
                showSolution: "üëÅÔ∏è Mostra Soluzione",
                hideSolution: "üôà Nascondi Soluzione",
                pass: "‚è≠Ô∏è Passa",
                next: "‚û°Ô∏è Prossima",
                endGame: "üèÅ Termina",
                menu: "üè† Menu",
                fileFormatTitle: "Informazioni Formato File",
                fileFormatContent: `<p><strong>Formato Richiesto:</strong></p>
                    <ul>
                        <li>File Excel (.xlsx, .xls) o file CSV (.csv)</li>
                        <li><strong>Colonna 1:</strong> parole/frasi Prima Lingua</li>
                        <li><strong>Colonna 2:</strong> parole/frasi Seconda Lingua</li>
                        <li>Varianti multiple possono essere separate da: / , \\ ( )</li>
                    </ul>
                    <br>
                    <p><strong>Esempio:</strong></p>
                    <table border="1" style="width:100%; border-collapse: collapse;">
                        <tr><th>Colonna 1 (Prima Lingua)</th><th>Colonna 2 (Seconda Lingua)</th></tr>
                        <tr><td>house/home</td><td>casa</td></tr>
                        <tr><td>car, automobile</td><td>macchina, auto</td></tr>
                        <tr><td>book</td><td>libro</td></tr>
                    </table>
                    <br>
                    <p><strong>Importante:</strong> Assicurati di selezionare le lingue corrette nel menu a tendina che corrispondono alle colonne del tuo file!</p>
                    <br>
                    <p><strong>Google Sheets:</strong><br>Assicurati che il foglio sia pubblico o condivisibile tramite link, poi incolla l'URL.</p>`
            }
        };

        // UI Language functions
        function setUILanguage(lang) {
            currentUILanguage = lang;
            
            // Update language selector buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });

            // Update all text elements
            document.querySelectorAll('[data-text]').forEach(element => {
                const key = element.dataset.text;
                if (translations[lang] && translations[lang][key]) {
                    if (element.innerHTML.includes('<')) {
                        element.innerHTML = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-placeholder]').forEach(element => {
                const key = element.dataset.placeholder;
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
        }

        // Language setup functions
        function updateLanguages() {
            const firstLang = document.getElementById('first-language').value;
            const secondLang = document.getElementById('second-language').value;
            
            fetch(`${API_BASE_URL}/set_languages`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    first_language: firstLang,
                    second_language: secondLang
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    gameState.audioEnabled = data.audio_enabled;
                    updateAudioStatus();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function updateAudioStatus() {
            const statusEl = document.getElementById('audio-status');
            const audioBtn = document.getElementById('audio-btn');
            
            if (gameState.audioEnabled) {
                statusEl.innerHTML = `<span data-text="audioEnabled">${translations[currentUILanguage].audioEnabled}</span>`;
                statusEl.className = 'status success';
                if (audioBtn) audioBtn.disabled = false;
            } else {
                statusEl.innerHTML = `<span data-text="audioDisabled">${translations[currentUILanguage].audioDisabled}</span>`;
                statusEl.className = 'status error';
                if (audioBtn) audioBtn.disabled = true;
            }
        }

        // Modal functions
        function showInfoModal() {
            document.getElementById('info-modal').style.display = 'flex';
        }

        function closeInfoModal() {
            document.getElementById('info-modal').style.display = 'none';
        }

        // Download example file
        function downloadExample() {
            const link = document.createElement('a');
            link.href = '/static/examples/Example.xlsx';
            link.download = 'Example.xlsx';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Status update function
        function updateStatus(message, type = 'default') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status';
            
            if (type === 'success') statusEl.classList.add('success');
            else if (type === 'error') statusEl.classList.add('error');
            else if (type === 'loading') statusEl.classList.add('loading');
        }

        // File loading functions
        function loadExcelFile() {
            document.getElementById('file-input').click();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            updateStatus('üîÑ Loading...', 'loading');

            const formData = new FormData();
            formData.append('file', file);

            fetch(`${API_BASE_URL}/load_excel`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus(data.message, 'success');
                    enableGameButtons();
                } else {
                    updateStatus(data.message, 'error');
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                updateStatus('‚ùå Loading error', 'error');
                alert('Server connection error');
            });
        }

        function loadGoogleSheets() {
            const url = document.getElementById('sheets-url').value.trim();
            if (!url) {
                alert('Please enter the Google Sheets URL!');
                return;
            }

            updateStatus('üîÑ Loading from Google Sheets...', 'loading');
            
            fetch(`${API_BASE_URL}/load_google_sheet`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url: url })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus(data.message, 'success');
                    enableGameButtons();
                } else {
                    updateStatus(data.message, 'error');
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                updateStatus('‚ùå Connection error', 'error');
                alert('Server connection error');
            });
        }

        function enableGameButtons() {
            document.getElementById('first-second-btn').disabled = false;
            document.getElementById('second-first-btn').disabled = false;
        }

        // Event handlers
        function handleUrlKeyPress(event) {
            if (event.key === 'Enter') {
                loadGoogleSheets();
            }
        }

        function handleAnswerKeyPress(event) {
            if (event.key === 'Enter') {
                if (!gameState.waitingForNext) {
                    checkAnswer();
                } else {
                    nextQuestion();
                }
            }
        }

        // Game functions
        function startGame(mode) {
            const maxQuestions = parseInt(document.getElementById('max-questions').value);
            const maxPasses = parseInt(document.getElementById('max-passes').value);
            
            fetch(`${API_BASE_URL}/start_game`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    mode: mode, 
                    max_questions: maxQuestions,
                    max_passes: maxPasses
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('menu-screen').style.display = 'none';
                    document.getElementById('game-screen').style.display = 'block';
                    
                    updateGameUI(data);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function updateGameUI(data) {
            document.getElementById('score-value').textContent = data.score;
            document.getElementById('question-progress').textContent = `${data.questions_asked}/${data.max_questions}`;
            document.getElementById('passes-left').textContent = data.passes_left;
            
            const progressPercent = (data.questions_asked / data.max_questions) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            // Update question text based on mode
            const questionTextEl = document.getElementById('question-text');
            if (data.question_type === 'first_second') {
                questionTextEl.textContent = translations[currentUILanguage].translateTo;
            } else {
                questionTextEl.textContent = translations[currentUILanguage].translateToFirst;
            }
            
            document.getElementById('question-word').textContent = data.question.split("'")[1];
            
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
            
            // Reset game state
            gameState.solutionVisible = false;
            gameState.waitingForNext = false;
            
            // Hide solution and reset buttons
            document.getElementById('solution-container').style.display = 'none';
            document.getElementById('check-btn').style.display = 'inline-flex';
            document.getElementById('solution-btn').querySelector('span').textContent = translations[currentUILanguage].showSolution;
            document.getElementById('next-btn').style.display = 'none';
            
            // Clear result message
            const resultEl = document.getElementById('result-message');
            resultEl.textContent = '';
            resultEl.className = 'result-message';
            
            // Update audio button state
            const audioBtn = document.getElementById('audio-btn');
            audioBtn.disabled = !gameState.audioEnabled;
        }

        function toggleSolution() {
            if (gameState.solutionVisible) {
                hideSolution();
            } else {
                showSolution();
            }
        }

        function showSolution() {
            fetch(`${API_BASE_URL}/show_solution`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    gameState.solutionVisible = true;
                    document.getElementById('solution-container').style.display = 'block';
                    document.getElementById('solution-word').textContent = data.solution;
                    document.getElementById('solution-btn').querySelector('span').textContent = translations[currentUILanguage].hideSolution;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function hideSolution() {
            fetch(`${API_BASE_URL}/hide_solution`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    gameState.solutionVisible = false;
                    document.getElementById('solution-container').style.display = 'none';
                    document.getElementById('solution-btn').querySelector('span').textContent = translations[currentUILanguage].showSolution;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function nextQuestion() {
            fetch(`${API_BASE_URL}/next_question`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.game_active) {
                        updateGameUI(data);
                    } else {
                        endGame();
                    }
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim();
            if (!userAnswer) return;
            
            fetch(`${API_BASE_URL}/check_answer`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ answer: userAnswer })
            })
            .then(response => response.json())
            .then(data => {
                const resultEl = document.getElementById('result-message');
                
                if (data.correct) {
                    resultEl.textContent = data.message;
                    resultEl.className = 'result-message result-correct';
                    
                    // Auto advance after correct answer
                    setTimeout(() => {
                        nextQuestion();
                    }, 2000);
                } else {
                    resultEl.textContent = data.message;
                    resultEl.className = 'result-message result-incorrect';
                    
                    // Show solution for wrong answers
                    if (data.solution_visible) {
                        gameState.solutionVisible = true;
                        document.getElementById('solution-container').style.display = 'block';
                        document.getElementById('solution-word').textContent = data.correct_answer;
                        document.getElementById('solution-btn').querySelector('span').textContent = translations[currentUILanguage].hideSolution;
                    }
                    
                    // Show next button and hide check button
                    document.getElementById('check-btn').style.display = 'none';
                    document.getElementById('next-btn').style.display = 'inline-flex';
                    gameState.waitingForNext = true;
                }
                
                document.getElementById('score-value').textContent = data.score;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function passQuestion() {
            fetch(`${API_BASE_URL}/pass_question`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const resultEl = document.getElementById('result-message');
                    resultEl.textContent = data.message;
                    resultEl.className = 'result-message result-skipped';
                    
                    document.getElementById('passes-left').textContent = data.passes_left;
                    
                    // Show solution when passing
                    if (data.solution_visible) {
                        gameState.solutionVisible = true;
                        document.getElementById('solution-container').style.display = 'block';
                        document.getElementById('solution-word').textContent = data.solution;
                        document.getElementById('solution-btn').querySelector('span').textContent = translations[currentUILanguage].hideSolution;
                    }
                    
                    // Show next button and hide check button
                    document.getElementById('check-btn').style.display = 'none';
                    document.getElementById('next-btn').style.display = 'inline-flex';
                    gameState.waitingForNext = true;
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function playAudio() {
            if (!gameState.audioEnabled) {
                alert('Audio is disabled when "Other" language is selected');
                return;
            }
            
            fetch(`${API_BASE_URL}/play_audio`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function endGame() {
            fetch(`${API_BASE_URL}/end_game`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let message = `üèÅ GAME ENDED!\n\n`;
                    message += `üìä Results:\n`;
                    message += `‚Ä¢ Questions answered: ${data.questions_asked}\n`;
                    message += `‚Ä¢ Final score: ${data.final_score}\n`;
                    message += `‚Ä¢ Percentage: ${data.percentage}%\n\n`;
                    
                    if (data.percentage >= 70) message += 'üéâ Excellent work!';
                    else if (data.percentage >= 50) message += 'üí™ Keep it up!';
                    else message += 'üìö More practice needed!';
                    
                    alert(message);
                    returnToMenu();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Server connection error');
            });
        }

        function returnToMenu() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'block';
            
            // Reset game state
            gameState.solutionVisible = false;
            gameState.waitingForNext = false;
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            setUILanguage('en');
            updateLanguages();
            
            // Close modal when clicking outside
            document.getElementById('info-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeInfoModal();
                }
            });
        });
    </script>
</body>
</html>